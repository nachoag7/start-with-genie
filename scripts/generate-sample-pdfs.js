const fs = require('fs');
const { jsPDF } = require('jspdf');

// Sample user data
const sampleUser = {
  fullName: "James White",
  businessName: "Prairie Tech Solutions LLC",
  shortBusinessName: "Prairie Tech Solutions LLC", // For titles that need to fit
  state: "North Dakota",
  email: "james.white@example.com",
  businessAddress: "123 Main Street, Fargo, ND 58102"
};

// Helper functions (same as in pdf-generator.ts)
function setAppleFont(doc, weight = 'normal') {
  doc.setFont('helvetica', weight);
}

function addAppleText(doc, text, x, y, options = {}) {
  const {
    fontSize = 12,
    maxWidth = 140,
    align = 'left',
    color = 30,
    spacing = 6
  } = options;

  doc.setFontSize(fontSize);
  doc.setTextColor(color);
  
  const lines = doc.splitTextToSize(text, maxWidth);
  let currentY = y;
  
  for (const line of lines) {
    if (currentY > 250) {
      doc.addPage();
      currentY = 40;
    }
    doc.text(line, x, currentY, { maxWidth, align });
    currentY += spacing;
  }
  
  doc.setTextColor(30);
  return currentY;
}

function addAppleHeading(doc, text, x, y, fontSize = 18) {
  setAppleFont(doc, 'bold');
  doc.setFontSize(fontSize);
  
  // Handle long titles by wrapping text
  const maxWidth = 150; // Adjust based on page width
  const lines = doc.splitTextToSize(text, maxWidth);
  let currentY = y;
  
  for (const line of lines) {
    doc.text(line, x, currentY);
    currentY += fontSize * 0.8; // Tighter line spacing for headings
  }
  
  return currentY + 8; // Add some space after the heading
}

function addAppleSignatureSection(doc, y, fullName) {
  y += 24;
  setAppleFont(doc, 'normal');
  doc.setFontSize(12);
  doc.text('Signature: ___________________________', 40, y);
  y += 20;
  doc.text(`Printed Name: ${fullName}`, 40, y);
  y += 20;
  const today = new Date().toLocaleDateString();
  doc.text(`Date: ${today}`, 40, y);
  y += 24;
  return y;
}

function addAppleFooter(doc) {
  const pageCount = doc.getNumberOfPages();
  doc.setPage(pageCount);
  const pageWidth = doc.internal.pageSize.getWidth();
  const y = 270;
  setAppleFont(doc, 'normal');
  doc.setFontSize(9);
  doc.setTextColor(120);
  doc.text('Generated by Start With Genie · Your personal LLC assistant', pageWidth / 2, y, { align: 'center' });
  doc.setTextColor(30);
}

function addAppleDisclaimer(doc) {
  const pageCount = doc.getNumberOfPages();
  doc.setPage(pageCount);
  const pageWidth = doc.internal.pageSize.getWidth();
  const y = 260;
  setAppleFont(doc, 'normal');
  doc.setFontSize(10);
  doc.setTextColor(120);
  doc.text('This document was generated as a helpful reference by Start With Genie. It is not a substitute for legal advice.', pageWidth / 2, y, { maxWidth: pageWidth - 80, align: 'center' });
  doc.setTextColor(30);
}

// Generate LLC Filing Instructions PDF
function generateLLCInstructionsPDF() {
  const doc = new jsPDF();
  const today = new Date().toLocaleDateString();
  
  let y = 40;
  
  // Title - shorter version to fit on page
  y = addAppleHeading(doc, `LLC Filing Instructions for Prairie Tech Solutions LLC`, 40, y, 16);
  
  // Subtitle
  setAppleFont(doc, 'normal');
  doc.setFontSize(14);
  doc.text(`Prepared for ${sampleUser.fullName} | Forming in ${sampleUser.state}`, 40, y);
  y += 8;
  doc.text('Start With Genie – Your personal LLC assistant', 40, y);
  y += 8;
  doc.text(`Effective Date: ${today}`, 40, y);
  y += 24;

  // Section 1
  y = addAppleHeading(doc, '1. Why This Step Matters', 40, y);
  y = addAppleText(doc, 'Filing your Articles of Organization is what officially creates your LLC with the state. Once approved, your business becomes legally recognized and ready to operate.', 40, y, { spacing: 8 });
  y += 16;

  // Section 2
  y = addAppleHeading(doc, '2. What You\'ll Need', 40, y);
  y = addAppleText(doc, `Business name: ${sampleUser.businessName} (your official name must include "LLC," "L.L.C.," or "Limited Liability Company")

Owner name(s): ${sampleUser.fullName}

Business address: ${sampleUser.businessAddress}
Address Tip: You can usually use your home address, but it must be a physical location — no PO Boxes. If you want privacy, a virtual office address may be an option.

Registered Agent (you or someone else in ${sampleUser.state})
What's a Registered Agent? This is the person or business responsible for receiving legal documents on behalf of your LLC. You can be your own agent if you're a ${sampleUser.state} resident with a physical address.

Management structure: Member-managed
Filing website login (some states require creating an account)`, 40, y, { spacing: 8 });
  y += 16;

  // Section 3
  y = addAppleHeading(doc, `3. Filing Details for ${sampleUser.state}`, 40, y);
  y = addAppleText(doc, `Here's what you need to know to file your LLC:

Filing Fee: $135
Processing Time: 1-2 business days
Where to File: https://sos.nd.gov
(This is the official Secretary of State or business portal for ${sampleUser.state})`, 40, y, { spacing: 8 });
  y += 16;

  // Section 4
  y = addAppleHeading(doc, '4. Step-by-Step Instructions', 40, y);
  y = addAppleText(doc, `Go to the link above and create an account (if required)

Select "Form a New LLC" or "Articles of Organization"

Enter your business and owner information:
- For Business Name, enter "${sampleUser.businessName}"
- Under Principal Office Address, use your business address
- For Organizers, list your name and title (e.g., "${sampleUser.fullName}, Member")
- For Management Type, choose "Member-managed"

Add your Registered Agent information

Pay the filing fee online

Submit the application and wait for approval`, 40, y, { spacing: 8 });
  y += 16;

  // Section 5
  y = addAppleHeading(doc, '5. After You File', 40, y);
  y = addAppleText(doc, 'Once approved, you\'ll receive a confirmation document or certificate from the state. Save this — you\'ll need it for your EIN, bank account, and taxes.\n\nNext step: Apply for your EIN and sign your Operating Agreement.', 40, y, { spacing: 8 });
  
  addAppleDisclaimer(doc);
  addAppleFooter(doc);
  
  return doc;
}

// Generate EIN Guide PDF
function generateEINGuidePDF() {
  const doc = new jsPDF();
  const today = new Date().toLocaleDateString();

  let y = 40;
  
  // Title - shorter version to fit on page
  y = addAppleHeading(doc, `EIN Instructions for Prairie Tech Solutions LLC`, 40, y, 16);
  
  // Subtitle
  setAppleFont(doc, 'normal');
  doc.setFontSize(14);
  doc.text(`Prepared for ${sampleUser.fullName} | Formed in ${sampleUser.state}`, 40, y);
  y += 8;
  doc.text('Start With Genie – Your personal LLC assistant', 40, y);
  y += 8;
  doc.text(`Effective Date: ${today}`, 40, y);
  y += 24;

  // Section 1
  y = addAppleHeading(doc, '1. What Is an EIN and Why It Matters', 40, y);
  y = addAppleText(doc, `An EIN (Employer Identification Number) is a unique ID issued by the IRS. It works like a Social Security Number for your business, and it's required for:

- Opening a business bank account
- Filing taxes
- Hiring employees
- Applying for business credit

Even if you're a single-member LLC, most banks and services will still require an EIN.`, 40, y, { spacing: 8 });
  y += 16;

  // Section 2
  y = addAppleHeading(doc, '2. Who Needs an EIN', 40, y);
  y = addAppleText(doc, `Most LLCs need an EIN. Even if you don't plan to hire employees, you'll likely need one to:

- Open a business bank account
- File federal or state taxes
- Apply for licenses, loans, or payment processors

Getting an EIN is completely free and only takes a few minutes online.`, 40, y, { spacing: 8 });
  y += 16;

  // Section 3
  y = addAppleHeading(doc, '3. How to Apply for an EIN Online', 40, y);
  y = addAppleText(doc, `The IRS provides a free online application for LLCs.

Where to apply:
https://irs.gov/ein

When:
Monday–Friday, 7:00 AM – 10:00 PM EST

What you'll need:
- Your name: ${sampleUser.fullName}
- Your business name: ${sampleUser.businessName}
- Business address: ${sampleUser.businessAddress}
- Business structure: LLC
- Confirmation that you are the owner

What to expect:
The application takes about 10 minutes. Once submitted, your EIN is issued immediately.

You don't need a lawyer or any advanced paperwork. Just answer honestly, and save your confirmation.`, 40, y, { spacing: 8 });
  y += 16;

  // Section 4
  y = addAppleHeading(doc, '4. What to Do After You Get Your EIN', 40, y);
  y = addAppleText(doc, `Once you receive your EIN:

- Download and save your confirmation letter (Form CP 575)
- Use it to open your business bank account
- You'll need it for taxes, payroll setup, and applying for credit
- Come back to your Genie Dashboard to download your Operating Agreement`, 40, y, { spacing: 8 });
  y += 16;

  // Section 5
  y = addAppleHeading(doc, '5. Alternate Filing Options (Mail or Fax)', 40, y);
  y = addAppleText(doc, `If you don't have a Social Security Number or can't use the online application:

1. Download IRS Form SS-4:
   https://www.irs.gov/forms-pubs/about-form-ss-4
2. Complete the form using your LLC details
   (Leave the SSN field blank if you're a non-U.S. resident)
3. Submit the form to the IRS by:
   - Fax: 855-641-6935
   - Mail:
     Internal Revenue Service
     Attn: EIN Operation
     Cincinnati, OH 45999

This method typically takes 2–4 weeks.`, 40, y, { spacing: 8 });
  
  addAppleDisclaimer(doc);
  addAppleFooter(doc);
  
  return doc;
}

// Generate Operating Agreement PDF
function generateOperatingAgreementPDF() {
  const doc = new jsPDF();
  const today = new Date().toLocaleDateString();

  let y = 40;
  
  // Title - shorter version to fit on page
  y = addAppleHeading(doc, `Operating Agreement for Prairie Tech Solutions LLC`, 40, y, 16);
  
  // Subtitle
  setAppleFont(doc, 'normal');
  doc.setFontSize(14);
  doc.text(`Prepared for ${sampleUser.fullName} | Formed in ${sampleUser.state}`, 40, y);
  y += 8;
  doc.text('Start With Genie – Your personal LLC assistant', 40, y);
  y += 8;
  doc.text(`Effective Date: ${today}`, 40, y);
  y += 24;

  // Section 1
  y = addAppleHeading(doc, '1. Introduction', 40, y);
  y = addAppleText(doc, `This Operating Agreement ("Agreement") is made effective as of the date above by and among the Member of ${sampleUser.businessName}, a limited liability company formed under the laws of the State of ${sampleUser.state}.`, 40, y, { spacing: 8 });
  y += 16;

  // Section 2
  y = addAppleHeading(doc, '2. Company Overview', 40, y);
  y = addAppleText(doc, `Business Name: ${sampleUser.businessName}
State of Formation: ${sampleUser.state}
Effective Date: ${today}
Entity Type: Single-Member LLC
Managed By: Member-managed
Principal Address: ${sampleUser.businessAddress}`, 40, y, { spacing: 8 });
  y += 16;

  // Section 3
  y = addAppleHeading(doc, '3. Purpose of the LLC', 40, y);
  y = addAppleText(doc, `The purpose of the LLC is to engage in any lawful business activity permitted under the laws of ${sampleUser.state}. The Member may modify the purpose as needed.`, 40, y, { spacing: 8 });
  y += 16;

  // Section 4
  y = addAppleHeading(doc, '4. Ownership', 40, y);
  y = addAppleText(doc, `Member: ${sampleUser.fullName}

This is a Single-Member LLC, owned and operated by ${sampleUser.fullName}.

Each Member owns an equal share of the LLC unless otherwise agreed in writing.`, 40, y, { spacing: 8 });
  y += 16;

  // Section 5
  y = addAppleHeading(doc, '5. Capital Contributions', 40, y);
  y = addAppleText(doc, `Initial contributions from Member: [Not specified]

No additional contributions are required unless agreed in writing by all Members.`, 40, y, { spacing: 8 });
  y += 16;

  // Section 6
  y = addAppleHeading(doc, '6. Profit and Loss Allocation', 40, y);
  y = addAppleText(doc, 'All profits and losses will be distributed in proportion to ownership, unless otherwise agreed upon in writing. Distributions will be made at the discretion of the Member.', 40, y, { spacing: 8 });
  y += 16;

  // Section 7
  y = addAppleHeading(doc, '7. Management and Voting', 40, y);
  y = addAppleText(doc, 'The LLC is Member-managed. Major decisions (such as admitting new members or dissolving the LLC) require approval by all Members.', 40, y, { spacing: 8 });
  y += 16;

  // Section 8
  y = addAppleHeading(doc, '8. Liability Protection', 40, y);
  y = addAppleText(doc, 'Members are not personally liable for the debts or obligations of the LLC. The LLC will indemnify Members to the extent permitted by law.', 40, y, { spacing: 8 });
  y += 16;

  // Section 9
  y = addAppleHeading(doc, '9. Ownership Changes', 40, y);
  y = addAppleText(doc, 'No Member may transfer ownership without written consent from the other Members, unless required by law.', 40, y, { spacing: 8 });
  y += 16;

  // Section 10
  y = addAppleHeading(doc, '10. Dissolution', 40, y);
  y = addAppleText(doc, `The LLC may be dissolved upon:
- A majority vote by Members
- Completion of its business purpose
- Only one Member remaining (if multi-member)

Upon dissolution, assets will be distributed in this order:
1. Creditors
2. Taxes
3. Members based on ownership`, 40, y, { spacing: 8 });
  y += 16;

  // Section 11
  y = addAppleHeading(doc, '11. Governing Law', 40, y);
  y = addAppleText(doc, `This Agreement is governed by the laws of the State of ${sampleUser.state}.`, 40, y, { spacing: 8 });
  
  // Signature section
  y = addAppleSignatureSection(doc, y, sampleUser.fullName);
  
  addAppleDisclaimer(doc);
  addAppleFooter(doc);
  
  return doc;
}

// Generate and save all PDFs
console.log('Generating sample PDFs...');

const llcDoc = generateLLCInstructionsPDF();
const llcPdf = Buffer.from(llcDoc.output('arraybuffer'));
fs.writeFileSync('public/sample-pdfs/LLC-Filing-Instructions-Prairie-Tech-Solutions-LLC.pdf', llcPdf);
console.log('✅ Generated LLC Filing Instructions PDF');

const einDoc = generateEINGuidePDF();
const einPdf = Buffer.from(einDoc.output('arraybuffer'));
fs.writeFileSync('public/sample-pdfs/EIN-Guide-Prairie-Tech-Solutions-LLC.pdf', einPdf);
console.log('✅ Generated EIN Guide PDF');

const oaDoc = generateOperatingAgreementPDF();
const oaPdf = Buffer.from(oaDoc.output('arraybuffer'));
fs.writeFileSync('public/sample-pdfs/Operating-Agreement-Prairie-Tech-Solutions-LLC.pdf', oaPdf);
console.log('✅ Generated Operating Agreement PDF');

console.log('All sample PDFs generated successfully!');